<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curr√≠culo de Corredores - thIAguinho Solu√ß√µes</title>
    <link rel="stylesheet" href="css/styles.css"> <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

    <link rel="manifest" href="manifest.json"> <meta name="theme-color" content="#007bff">

</head>
<body>

    <div class="container">
        <div class="header">
            <button class="auth-btn hidden" id="btn-back-to-public">‚¨ÖÔ∏è Voltar √† Lista</button>
            <button class="auth-btn hidden" id="btn-back-to-my-dashboard">‚¨ÖÔ∏è Voltar ao Meu Painel</button>

            <div class="auth-controls">
                <div id="user-info" class="hidden">
                    <span id="user-email"></span>
                </div>
                <button class="auth-btn hidden" id="btn-logout">Logout</button>
            </div>

            <h1>Curr√≠culo de Corridas de Rua üèÉüèΩ‚Äç‚ôÇÔ∏èüèÉüèΩ‚Äç‚ôÄÔ∏è</h1>
            <p id="header-subtitle">Carregando...</p>
        </div>

        <div id="admin-panel" class="hidden">
            <h2>‚öôÔ∏è Painel de Admin</h2>

            <div class="admin-grid">
                 <div class="admin-section" id="admin-users-section">
                    <h3 class="admin-section-toggle">
                        Gest√£o de Usu√°rios
                        <i class='bx bxs-chevron-down admin-toggle-icon'></i>
                    </h3>
                    <div class="admin-section-content"> <h4>Aprova√ß√µes Pendentes</h4>
                        <div id="pending-list">
                            <div class="loader" style="color:#1f2027;">Carregando...</div>
                        </div>

                        <h4>Usu√°rios Aprovados</h4>
                        <div id="approved-list">
                             <div class="loader" style="color:#1f2027;">Carregando...</div>
                        </div>
                    </div>
                </div>

                <div class="admin-section" id="admin-races-section">
                     <h3 class="admin-section-toggle">
                        Gest√£o de Corridas e Dados
                        <i class='bx bxs-chevron-down admin-toggle-icon'></i>
                    </h3>
                     <div class="admin-section-content"> <div>
                            <h4 id="form-title">Cadastrar Nova Corrida</h4>
                            <form id="race-form-admin">
                                <input type="hidden" id="race-id-admin">
                                <div class="form-group"> <label for="race-name">Nome</label> <input type="text" id="race-name" class="form-input" required> </div>
                                <div class="form-group"> <label for="race-city">Cidade</label> <input type="text" id="race-city" class="form-input" required> </div>
                                <div class="form-group"> <label for="race-date-admin">Data</label> <input type="date" id="race-date-admin" class="form-input" required style="color-scheme: dark;"> </div>
                                <div class="form-group"> <label for="race-link">Link Inscri√ß√£o</label> <input type="url" id="race-link" placeholder="https://" class="form-input"> </div>
                                <div class="form-group"> <label for="race-calendar">Calend√°rio</label> <select id="race-calendar" class="form-input"> <option value="copaAlcer">Copa Alcer</option> <option value="geral">Regi√£o</option> </select> </div>
                                <div class="form-buttons-inline"> <button type="submit" class="btn btn-primary">Salvar</button> <button type="reset" id="clear-form-button" class="btn btn-secondary">Limpar</button> </div>
                            </form>
                        </div>

                        <div id="admin-race-lists">
                            <h4>Corridas Cadastradas</h4>
                            <h5 class="admin-race-list-title">Copa Alcer</h5>
                            <div id="copa-race-list" class="admin-race-list"> <div class="loader...">...</div> </div>
                            <h5 class="admin-race-list-title">Regi√£o</h5>
                            <div id="geral-race-list" class="admin-race-list"> <div class="loader...">...</div> </div>
                        </div>

                        <div id="admin-upload-section">
                            <h4>Upload de Dados</h4>
                            <div class="form-group">
                                <h5 class="admin-race-list-title">Resultados Etapa</h5>
                                <p class="form-help-text">Adicionar resultados .json de uma corrida.</p>
                                <label for="race-select-results">Selecione Etapa</label> <select id="race-select-results" class="form-input"></select>
                            </div>
                            <div class="form-group"> <label for="results-file">Arquivo Resultados</label> <input type="file" id="results-file" accept=".json" class="form-input-file"/> </div>
                            <button id="upload-results-button" class="btn btn-primary">Enviar Resultados</button> <p id="upload-results-status" class="upload-status"></p>

                            <div class="form-group" style="margin-top: 20px; border-top: 1px dashed #5f4c00; padding-top: 20px;">
                                 <h5 class="admin-race-list-title">Ranking Final</h5>
                                 <p class="form-help-text">Substituir ranking .json completo.</p>
                                 <label for="ranking-file">Arquivo Ranking</label> <input type="file" id="ranking-file" accept=".json" class="form-input-file"/>
                            </div>
                            <button id="upload-ranking-button" class="btn btn-primary">Enviar Ranking</button> <p id="upload-ranking-status" class="upload-status"></p>
                        </div>
                     </div>
                </div>
            </div>
        </div>

        <div id="login-or-public-view">

            <div id="login-view">
                <h2 id="login-title">Acessar Meu Curr√≠culo</h2>
                <form id="login-form">
                    <input type="email" id="login-email" placeholder="E-mail" required>
                    <input type="password" id="login-password" placeholder="Senha (m√≠n. 6)" required>
                    <div id="signup-fields" class="hidden">
                        <input type="text" id="signup-runner1-name" placeholder="Seu nome (Ex: Thiago)" required>
                        <input type="text" id="signup-runner2-name" placeholder="Nome Corredor 2 (Opcional)">
                        <input type="text" id="signup-team-name" placeholder="Nome da Equipe">
                    </div>
                    <div class="login-buttons">
                         <button type="button" class="auth-btn btn-primary" id="btn-login-submit">Entrar</button>
                         <button type="button" class="auth-btn" id="btn-signup-submit">Cadastrar</button>
                    </div>
                    <div id="login-error"></div>
                    <a id="login-toggle-link">N√£o tem conta? Cadastre-se</a>
                </form>
            </div>

            <div id="public-view" class="hidden">
                <h2>Curr√≠culos P√∫blicos</h2>
                <div class="profile-list" id="public-profile-list-public">
                    <div class="loader">Carregando...</div>
                </div>
                <div class="public-calendar-section">
                    <h2 class="section-title">Pr√≥ximas Etapas - <span class="text-blue-highlight">Copa Alcer</span></h2>
                    <div id="copa-container-public" class="calendar-grid"><p class="loader">Carregando...</p></div>
                    <h2 class="section-title">Resultados Anteriores</h2>
                    <div id="resultados-container-public" class="calendar-grid"><p class="loader">Carregando...</p></div>
                    <h2 class="section-title">Outras Corridas</h2>
                    <div id="geral-container-public" class="calendar-grid"><p class="loader">Carregando...</p></div>
                </div>
            </div>
        </div>

        <div id="pending-approval-view" class="hidden">
            <h2>‚è≥ Cadastro Recebido</h2> <p>Aguardando aprova√ß√£o do admin.</p>
        </div>
        <div id="rejected-view" class="hidden">
            <h2>‚ùå Acesso Recusado</h2> <p>Cadastro para <b id="rejected-email"></b> n√£o aprovado.</p>
        </div>

        <div id="user-content" class="hidden">
            <div class="dashboard-section">
                <h2 class="dashboard-header">Dashboard Performance</h2>
                <h3 class="dashboard-subheader">Recordes Pessoais (PRs)</h3>
                <div class="stats-grid" id="pr-grid"><div class="loader">Carregando...</div></div>
                <h3 class="dashboard-subheader" style="margin-top: 30px;">Estat√≠sticas Gerais</h3>
                <div class="stats-grid" id="summary-grid"><div class="loader">Calculando...</div></div>
            </div>
            <div class="controls-section hidden" id="controls-section">
                <button class="btn-add" id="btn-add-new">‚ûï Adicionar Corrida Pessoal</button>
            </div>
            <div class="history-section">
                <h2 class="dashboard-header">Meu Hist√≥rico Pessoal</h2>
                <div id="history-container"><div class="loader">Carregando...</div></div>
            </div>
            <div class="public-profile-list-section">
                <h2 class="section-title">Outros Curr√≠culos P√∫blicos</h2>
                <div class="profile-list" id="public-profile-list-logged"><div class="loader">Carregando...</div></div>
            </div>
            <div class="public-calendar-section" style="background: #1a1a2e; padding-top: 20px;">
                <h2 class="section-title">Pr√≥ximas Etapas - <span class="text-blue-highlight">Copa Alcer</span></h2>
                <div id="copa-container-logged" class="calendar-grid"><p class="loader">Carregando...</p></div>
                <h2 class="section-title">Resultados Anteriores</h2>
                <div id="resultados-container-logged" class="calendar-grid"><p class="loader">Carregando...</p></div>
                <h2 class="section-title">Outras Corridas</h2>
                <div id="geral-container-logged" class="calendar-grid"><p class="loader">Carregando...</p></div>
            </div>
        </div>

        <div class="footer">
            Desenvolvido com ü§ñ por <a href="https://thiaguinhosolucoesia-tech.github.io/thIAguinhoSolucoes/" target="_blank" rel="noopener noreferrer"><strong>thIAguinho Solu√ß√µes</strong></a>
        </div>
    </div>

    <dialog id="race-modal">
        <form id="race-form">
            <input type="hidden" id="race-id">
            <div class="modal-header"> <h2 id="modal-title">...</h2> <button type="button" class="btn-control" id="btn-close-modal" aria-label="Fechar">‚úñÔ∏è</button> </div>
            <div class="modal-body"> </div>
            <div class="modal-footer"> <button type="button" class="btn hidden" id="btn-delete">Excluir</button> <button type="button" class="btn btn-secondary" id="btn-cancel">Cancelar</button> <button type="submit" class="btn btn-primary" id="btn-save">Salvar</button> </div>
        </form>
    </dialog>

    <div id="modal-overlay" class="v2-modal-overlay hidden">
        <div id="results-modal" class="v2-modal-content">
            <button id="btn-close-results-modal" class="v2-modal-close-btn">&times;</button>
            <div class="v2-modal-header"> <h2 id="modal-title-results" class="v2-modal-title">Resultados</h2> </div>
            <div class="v2-modal-body"> <input type="text" id="modal-search-input" placeholder="Buscar atleta..." class="form-input"> <div id="modal-content-results" class="v2-modal-results-container"></div> </div>
        </div>
    </div>

    <dialog id="user-edit-modal">
        <form id="user-edit-form">
            <input type="hidden" id="user-edit-uid">
            <div class="modal-header">
                <h2 id="user-edit-modal-title">Editar Perfil de Usu√°rio</h2>
                <button type="button" class="btn-control" id="user-edit-btn-close-modal" aria-label="Fechar">‚úñÔ∏è</button>
            </div>
            <div class="modal-body">
                <div class="form-group full-width"> <label for="user-edit-runner1-name">Nome Corredor 1</label> <input type="text" id="user-edit-runner1-name" class="form-input" required> </div>
                <div class="form-group full-width"> <label for="user-edit-runner2-name">Nome Corredor 2 (branco=remover)</label> <input type="text" id="user-edit-runner2-name" class="form-input"> </div>
                <div class="form-group full-width"> <label for="user-edit-team-name">Nome da Equipe</label> <input type="text" id="user-edit-team-name" class="form-input"> </div>
                <div id="user-edit-error" style="color: red; grid-column: 1 / -1; text-align: center; min-height: 1.2em;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="user-edit-btn-cancel">Cancelar</button>
                <button type="submit" class="btn btn-primary" id="user-edit-btn-save">Salvar Altera√ß√µes</button>
            </div>
        </form>
    </dialog>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script src="js/config.js"></script> <script src="js/admin-logic.js"></script> <script src="js/main-logic.js"></script> <script>
        // Registra o Service Worker (Caminho raiz original)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js') // Caminho raiz original
                    .then(registration => {
                        console.log('SW registrado:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Falha SW:', error);
                    });
            });
        }
    </script>
    <link rel="apple-touch-icon" href="icons/icon-192x192.png"> </body>
</html>
